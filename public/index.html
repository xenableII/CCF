<!DOCTYPE html> 
<html lang="fr"> 
 <head> 
 <meta charset="UTF-8"> 
 <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"> 
 <title>Scanner EAN-13</title> 
 
 <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> 
 <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.min.js"></script> 
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
rel="stylesheet"> 
 
  <style> 
   body { 
    margin: 0; 
    padding: 0; 
    height: 100vh; 
    display: flex; 
    flex-direction: column; /* par défaut : smartphone vertical */ 
    font-family: Arial; 
   } 
 
   /* --- CONTENEUR PRINCIPAL --- */ 
   #main { 
    flex: 1; 
    display: flex; 
    flex-direction: column; /* vertical par défaut */ 
   } 
 
   /* --- CAMÉRA --- */ 
   #camera { 
    background: black; 
    width: 100%; 
    height: 50vh; /* smartphone vertical : moitié écran */ 
    min-height: 250px; /* indispensable pour que Quagga démarre */ 
    position: relative; 
   } 
#camera video, #camera canvas { 
    position: absolute; 
    top: 0; left: 0; 
    width: 100% !important; 
    height: 100% !important; 
    object-fit: cover; 
   } 
 
   /* --- INFOS --- */ 
   #info { 
    flex: 1; 
    padding: 20px; 
    background: #f7f7f7; 
   } 
 
   /* --- MODE PAYSAGE + TABLETTES + PC --- */ 
   @media (orientation: landscape), (min-width: 768px) { 
    #main { 
     flex-direction: row; /* caméra gauche, infos droite */ 
    } 
    #camera { 
     width: 50%; 
     height: 100%; 
    } 
    #info { 
     width: 50%; 
     height: 100%; 
    } 
   } 
  </style> 
 
  <script> 
   document.addEventListener("DOMContentLoaded", function() { 
    /* ========== DÉMARRAGE SCANNER ========== */ 
    function startScanner() { 
     const target = document.querySelector("#camera"); 
 
     Quagga.init({ 
      inputStream: { 
       type: "LiveStream", 
       target: target, 
       constraints: { 
        facingMode: "environment", 
        width: { ideal: target.clientWidth }, 
        height: { ideal: target.clientHeight } 
       } 
      }, 
      decoder: { readers: ["ean_reader"] } 
     }, (err) => { 
      if (err) { 
       console.error("Erreur Quagga:", err); 
       return; 
      } 
      Quagga.start(); 
     }); 
 
     Quagga.onDetected((res) => { 
      const code = res.codeResult.code; 
      $("#result").text(code); 
 
      if (code.length === 13)
        getItemFromServer(code); 
     }); 
    } 
 
    /* ========== REDÉMARRAGE ========== */ 
    $("#restartBtn").click(() => { 
     Quagga.stop(); 
     $("#result").text("Aucun"); 
     $("#description").text("En attente…"); 
     $("#price").text("En attente…"); 
     setTimeout(startScanner, 300); 
    }); 
 
    /* ========== REQUÊTE SERVEUR ========== */ 
    function getItemFromServer(code) { 
     $.post("/api/article", { codeBarre: code }, (r) => { 
      if (r.message === "OK") { 
       $("#description").text(r.results.designation); 
       $("#price").text(r.results.prix + " €"); 
      } else { 
       $("#description").text("Article non trouvé"); 
       $("#price").text("N/A"); 
      } 
     }).fail(() => { 
      $("#description").text("Erreur serveur"); 
      $("#price").text("N/A"); 
     }); 
    } 
    /* ========== ON LANCE LE SCAN ========== */ 
    startScanner(); 
   }); 
  </script> 
 </head> 
 <body> 
  <div id="main"> 
   <div id="camera"></div> 
   <div id="info"> 
    <h2>Scanner EAN-13</h2> 
    <p>Code : <span id="result">Aucun</span></p> 
    <p>Description : <span id="description">En attente…</span></p> 
    <p>Prix : <span id="price">En attente…</span></p> 
    <button id="restartBtn" class="btn btn-warning w-100 mt
3">Redémarrer</button> 
   </div> 
  </div> 
 </body> 
</html> 
